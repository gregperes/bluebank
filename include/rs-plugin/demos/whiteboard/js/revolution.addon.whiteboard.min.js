/********************************************
 * REVOLUTION 5.0+ EXTENSION - WHITEBOARD
 * @version: 1.0.2 (16.03.2016)
 * @requires jquery.themepunch.revolution.js
 * @author ThemePunch
*********************************************/
!function(e){var t=jQuery.fn;jQuery.extend(!0,t,{rsWhiteBoard:function(e){return this.each(function(){var e=jQuery(this).data("opt");jQuery(this).on("revolution.slide.onloaded",function(){a(e)})})}});var a=function(e){if(o=e.whiteboard,void 0===o)return!1;var t="position:absolute;z-index:1000;top:0px;left:0px;",a="position:absolute;z-index:1000;top:0px;left:0px;",n="position:absolute;z-index:1000;top:0px;left:0px;",r="position:absolute; top:0px;left:0px;background-size:contain;background-repeat:no-repeat;background-position:center center;";void 0!=o.movehand&&(o.movehand.markup='<div class="wb-move-hand wb-thehand" style="'+t+'"><div class="wb-hand-inner" style="'+a+";width:"+o.movehand.width+"px;height:"+o.movehand.height+'px"><div class="wb-hand-scale" ><div class="wb-hand-image" style="'+r+"width:"+o.movehand.width+"px;height:"+o.movehand.height+"px;background-image:url("+o.movehand.src+');"></div></div></div>'),void 0!=o.writehand&&(o.writehand.markup='<div class="wb-draw-hand wb-thehand" style="'+t+'"><div class="wb-hand-inner" style="'+a+'"><div class="wb-hand-scale" style="'+n+'"><div class="wb-hand-image" style="'+r+"width:"+o.writehand.width+"px;height:"+o.writehand.height+"px;background-image:url("+o.writehand.src+');"></div></div></div>'),jQuery(window).resize(function(){clearTimeout(e.whiteboard_resize_timer),e.whiteboard_resize_timer=setTimeout(function(){jQuery(".wb-thehand").each(function(){var t=jQuery(this).find(".wb-hand-scale");punchgs.TweenLite.set(t,{scale:e.bw})})},50)}),e.c.on("revolution.slide.onbeforeswap",function(t,a){e.c.find(".wb-thehand").remove()}),e.c.on("revolution.layeraction",function(t,a){var n=a.layersettings.whiteboard;if(void 0!=n){1!=n.configured&&(("write"==n.hand_function||"draw"==n.hand_function)&&(n.jitter_distance=void 0!=n.jitter_distance?parseInt(n.jitter_distance,0)/100:parseInt(o.writehand.jittering.distance,0)/100,n.jitter_distance_horizontal=void 0!=n.jitter_distance_horizontal?parseInt(n.jitter_distance_horizontal,0)/100:parseInt(o.writehand.jittering.distance_horizontal,0)/100,n.jitter_offset=void 0!=n.jitter_offset?parseInt(n.jitter_offset,0)/100:parseInt(o.writehand.jittering.offset,0)/100,n.jitter_offset_horizontal=void 0!=n.jitter_offset_horizontal?parseInt(n.jitter_offset_horizontal,0)/100:parseInt(o.writehand.jittering.offset_horizontal,0)/100,n.hand_type=n.hand_type||o.writehand.handtype),"move"==n.hand_function&&(n.hand_type=n.hand_type||o.movehand.handtype),n.configured=!0);var r=a.layersettings._pw.find(".wb-thehand");if(r.length>0)var s=r.data("wb");else var s=jQuery.extend(!0,{},a.layersettings.whiteboard);if("enterstage"==a.eventtype){if(jQuery(a.layer).is(":visible")===!1)return;a.layer.hasClass("handadded")||(a.layer.addClass("handadded"),a.layersettings.handEffect="on",1!=s.handadded&&d(e,a,s),h(a,s))}"enteredstage"==a.eventtype&&a.layer.hasClass("handadded")&&!a.layer.hasClass("handremoved")&&(a.layer.addClass("handremoved"),a.layersettings.handEffect="off",0==i(e,a,s)&&f(e,a,s)),"leavestage"==a.eventtype&&(a.layer.removeClass("handadded"),a.layer.removeClass("handremoved"))}})},n=function(e){var t={};return t.obj="",t.startat=9999999,e.layersettings._li.find(".tp-caption").each(function(){var e=jQuery(this);1!=e.data("active")&&void 0!=e.data("whiteboard")&&"move"!=e.data("whiteboard").hand_function&&parseInt(e.data("start"),0)<t.startat&&(t.obj=e,t.startat=parseInt(e.data("start"),0))}),t},i=function(e,t,a){var i=!1,o=t.layersettings._pw.find(".wb-thehand");if("on"===t.layersettings.whiteboard.goto_next_layer&&"move"!=t.layersettings.whiteboard.hand_function&&0==e.c.find(".wb-between-stations").length){var r=n(t);if(void 0!=r&&r.obj.length>0){var s=o.find(".wb-hand-inner"),d=r.startat/1e3-t.layersettings.timeline._totalDuration,h=t.layersettings._pw.position(),f=r.obj.data("_pw").position(),l=o.closest(".tp-static-layers").length>0?!0:!1;o.appendTo(e.ul),o.addClass("wb-between-stations"),l?o.css({zIndex:200}):o.css({zIndex:100}),a.handEffect="off",punchgs.TweenLite.fromTo(o,d,{top:h.top,left:h.left},{top:f.top,left:f.left}),punchgs.TweenLite.to(s,d,{x:0,y:0,onComplete:function(){o.remove()}}),i=!0}}return i},r=function(e,t,a){if("off"!=a.handEffect&&1==a.handadded){var n=(a.maxwave||t.layersettings.eoh,parseInt(a.hand_angle,0)||10);ro="write"==a.hand_function||"draw"==a.hand_function?Math.random()*n-n/2:0,a.rotatespeed=a.rotatespeed||.05,a.rotating_anim=punchgs.TweenLite.to(e,a.rotatespeed,{rotationZ:ro,ease:punchgs.Power3.easeOut,onComplete:function(){r(e,t,a)}})}},s=function(e,t,a){if("off"!=a.handEffect&&1==a.handadded)if("horizontal"==a.jitter_direction){var n=a.maxwave||t.layersettings.eow*a.jitter_distance_horizontal,i=t.layersettings.eow*a.jitter_offset_horizontal;if(0==n)return;a.current_x_offset=a.current_x_offset||0,a.lastwave=Math.random()*n+i,a.jitterspeed=a.jitterspeed||.05,a.jittering_anim=punchgs.TweenLite.to(e,a.jitterspeed,{x:a.lastwave,ease:punchgs.Power3.easeOut,onComplete:function(){s(e,t,a)}})}else{var o=a.maxwave||t.layersettings.eoh;if(0==o)return;a.current_y_offset=a.current_y_offset||0,a.lastwave=a.lastwave==a.current_y_offset+o*a.jitter_offset?Math.random()*(o*a.jitter_distance)+a.current_y_offset+o*a.jitter_offset:a.current_y_offset+o*a.jitter_offset,a.jitterspeed=a.jitterspeed||.05,a.jittering_anim=punchgs.TweenLite.to(e,a.jitterspeed,{y:a.lastwave,ease:punchgs.Power3.easeOut,onComplete:function(){s(e,t,a)}})}},d=function(e,t,a){var n="move"==a.hand_function?e.whiteboard.movehand:e.whiteboard.writehand,i=n.markup;a.hand_full_rotation=a.hand_full_rotation||0,a.hand_origin=n.transform.transformX+"px "+n.transform.transformY+"px",a.hand_scale="right"==a.hand_type?1:-1,a.hand_x_offset=parseInt(a.hand_x_offset,0)||0,a.hand_y_offset=parseInt(a.hand_y_offset,0)||0,jQuery(i).appendTo(t.layersettings._pw),a.handadded=!0;var o=t.layersettings._pw.find(".wb-thehand"),r=(o.find(".wb-hand-inner"),o.find(".wb-hand-image"));punchgs.TweenLite.set(r,{scaleX:a.hand_scale,rotation:a.hand_full_rotation,transformOrigin:a.hand_origin,x:0-n.transform.transformX+a.hand_x_offset,y:0-n.transform.transformY+a.hand_y_offset}),punchgs.TweenLite.set(o.find(".wb-hand-scale"),{scale:e.bw,transformOrigin:"0% 0%"})},h=function(e,t){var a=e.layersettings._pw.find(".wb-thehand"),n=a.find(".wb-hand-inner"),i=(a.find(".wb-hand-image"),punchgs.TweenLite.getTweensOf(e.layer));switch(t.hand_function){case"write":case"draw":var o=e.layersettings.speed;if(void 0!=e.layersettings.splitin&&"none"!=e.layersettings.splitin)t.tweens=e.layersettings.timeline.getChildren(!0,!0,!1),jQuery.each(t.tweens,function(a,i){i.eventCallback("onStart",function(e,t,n){var i=jQuery(this.target),o=i.width(),r=i.height();if(i.html().length>0&&9!=i.html().charCodeAt(0)&&10!=i.html().charCodeAt(0)){var s=i.position(),d=i.parent(),h=d.parent(),f=("write"==n.hand_function?10*Math.random()-5:0,this._duration),l=s.left,p=s.top;d.hasClass("tp-splitted")&&(l=d.position().left+l,p=d.position().top+p),h.hasClass("tp-splitted")&&(l=h.position().left+l,p=h.position().top+p),n.rotatespeed=void 0!==n.hand_angle_repeat?parseFloat(f)/parseFloat(n.hand_angle_repeat):f>1?f/6:f>.5?f/6:f/3,n.jitterspeed=void 0!==n.jitter_repeat?parseFloat(f)/parseFloat(n.jitter_repeat):f>1?f/6:f>.5?f/6:f/3,n.current_y_offset!=p&&(f=.1),n.current_y_offset=p||0,n.maxwave=r,a<n.tweens.length-1?punchgs.TweenLite.to(e,f,{x:l+o}):punchgs.TweenLite.to(e,f,{x:l+o,onComplete:function(){n.handEffect="off";try{n.jittering_anim.kill(!1)}catch(e){}}})}else{n.current_y_offset=0,n.maxwave=r,n.handEffect="off";try{n.jittering_anim.kill(!1)}catch(c){}}},[n,e,t])});else{var d=e.layersettings.eow*t.jitter_distance_horizontal,h=e.layersettings.eow*t.jitter_offset_horizontal,f=e.layersettings.eoh*t.jitter_distance,l=e.layersettings.eoh*t.jitter_offset;if(t.rotatespeed=void 0!==t.hand_angle_repeat?parseFloat(o)/parseFloat(t.hand_angle_repeat):o>1?o/6:o>.5?o/6:o/3,t.jitterspeed=void 0!==t.jitter_repeat?parseFloat(o)/parseFloat(t.jitter_repeat):o>1?o/6:o>.5?o/6:o/3,"right_to_left"==t.hand_direction){var p=e.layersettings.eow-h,c=p-d;punchgs.TweenLite.fromTo(n,o,{x:p},{x:c,ease:e.layersettings.ease,onComplete:function(){t.handEffect="off"}})}else if("top_to_bottom"==t.hand_direction){var _=l,u=_+f;punchgs.TweenLite.fromTo(n,o,{y:_},{y:u,ease:e.layersettings.ease,onComplete:function(){t.handEffect="off"}}),t.jitter_direction="horizontal"}else if("bottom_to_top"==t.hand_direction){var _=e.layersettings.eoh-l,u=_-f;punchgs.TweenLite.fromTo(n,o,{y:_},{y:u,ease:e.layersettings.ease,onComplete:function(){t.handEffect="off"}}),t.jitter_direction="horizontal"}else{var p=h,c=p+d;punchgs.TweenLite.fromTo(n,o,{x:p},{x:c,ease:e.layersettings.ease,onComplete:function(){t.handEffect="off"}})}}s(n,e,t),r(n,e,t);break;case"move":a.data("outspeed",e.layersettings.speed),a.data("outease",e.layersettings.ease),i[0].eventCallback("onUpdate",function(e){var n=(this.target.style,this.target._gsTransform),i={};i.x=n.x,i.y=n.y,void 0===a.data("pos")&&a.data("pos",i),t.hand_inner_animation=punchgs.TweenLite.set(a,{x:i.x,y:i.y})},[e])}a.data("wb",t)},f=function(e,t,a){var n=t.layersettings._pw.find(".wb-thehand"),i=n.data("pos")||{x:0,y:0},o=n.position()||{top:0,left:0},r=n.data("outspeed")||2,s=0==i.x&&0==i.y?0:1;if(r=.5*r,"move"!=a.hand_function){var d=t.layersettings._pw.position();e.c.offset();o.left="right"==a.hand_type?e.c.width()-d.left+t.layersettings.eow:0-d.left-t.layersettings.eow,o.top=e.c.height()}punchgs.TweenLite.to(n,r,{top:o.top,left:o.left,autoAlpha:s,x:i.x,y:i.y,ease:n.data("outease"),onComplete:function(){n.remove(),a.handadded=!1}})}}(jQuery);